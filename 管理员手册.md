# 🔧 安全教育助手 - 管理员手册

## 📋 系统概述

安全教育助手是一个基于Streamlit的Web应用，帮助江苏省大学新生自动完成安全知识教育学习。系统采用使用码机制控制访问权限。

## 🚀 部署和启动

### 环境要求
- Python 3.9+
- 依赖包：streamlit, requests, sqlite3

### 启动应用
```bash
# 使用uv（推荐）
uv run streamlit run streamlit_app.py

# 或使用python
python -m streamlit run streamlit_app.py
```

### 访问地址
- 本地访问：http://localhost:8501
- 网络访问：http://[服务器IP]:8501

## 🔑 使用码管理

### 生成使用码
```bash
# 生成10个使用码
python3 generate_codes.py 10

# 生成并导出到文件
python3 generate_codes.py 20 --export codes.txt

# 查看统计信息
python3 generate_codes.py --stats

# 交互式生成
python3 generate_codes.py
```

### 特殊测试码
- **888888** - 永久有效的测试码
- 特点：不会被消耗，可无限使用
- 用途：开发测试、演示功能
- 注意：不要告诉最终用户

### 使用码特性
- 6位随机数字（0-9）
- 方便用户记忆和输入
- 每个码只能使用一次
- 只有任务成功完成才会被标记为已使用
- 任务失败时不会被消耗

## 📊 监控和日志

### 日志文件
- 文件名：`app_log_YYYYMMDD.log`
- 位置：应用根目录
- 内容：用户操作、错误信息、使用码使用情况

### 查看日志
```bash
# 查看今天的日志
tail -f app_log_$(date +%Y%m%d).log

# 查看所有日志文件
ls app_log_*.log
```

### 数据库管理
```bash
# 查看使用码统计
python3 generate_codes.py --stats

# 查看数据库内容
sqlite3 database.db "SELECT * FROM registration_codes ORDER BY created_at DESC LIMIT 10;"

# 查看已使用的码
sqlite3 database.db "SELECT code, used_at, used_by FROM registration_codes WHERE status='used' ORDER BY used_at DESC;"
```

## 🛠️ 维护操作

### 清理过期日志
```bash
# 删除7天前的日志
find . -name "app_log_*.log" -mtime +7 -delete
```

### 数据库备份
```bash
# 备份数据库
cp database.db database_backup_$(date +%Y%m%d).db

# 恢复数据库
cp database_backup_YYYYMMDD.db database.db
```

### 重置使用码（谨慎操作）
```bash
# 删除所有使用码
sqlite3 database.db "DELETE FROM registration_codes;"

# 重置自增ID
sqlite3 database.db "DELETE FROM sqlite_sequence WHERE name='registration_codes';"
```

## 🔧 故障排除

### 常见问题

**应用无法启动**
- 检查Python环境和依赖
- 查看错误日志
- 确认端口8501未被占用

**使用码验证失败**
- 检查数据库连接
- 确认使用码格式正确
- 查看应用日志

**任务执行失败**
- 检查main.py脚本
- 确认网络连接
- 查看详细错误日志

### 调试模式
```bash
# 启动时显示详细日志
streamlit run streamlit_app.py --logger.level=debug
```

## 📱 移动端优化

### 界面特性
- 响应式布局，适配手机屏幕
- 大号按钮和输入框
- 简化的用词，避免技术术语
- 隐藏敏感信息和技术细节

### 用户体验
- 清晰的步骤指引
- 友好的错误提示
- 自动网址验证
- 进度显示

## 🔒 安全考虑

### 访问控制
- 使用码机制防止未授权访问
- 每个码只能使用一次
- 详细的使用日志记录

### 数据保护
- 不保存用户密码
- 最小化敏感信息显示
- 后台日志记录操作详情

### 建议配置
- 使用HTTPS部署
- 定期更换使用码
- 监控异常访问

## 📈 使用统计

### 查看统计信息
```bash
# 使用码统计
python3 demo_registration_codes.py

# 详细统计
python3 generate_codes.py --stats
```

### 导出报告
```bash
# 导出使用记录
sqlite3 database.db -header -csv "SELECT * FROM registration_codes;" > usage_report.csv
```

---

*如有技术问题，请查看日志文件或联系开发人员*
